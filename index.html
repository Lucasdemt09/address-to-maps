<!DOCTYPE html>
<html>
<head>
    <title>Upload and Process Excel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Upload Excel File</h1>
    <input type="file" id="fileInput" />
    <button onclick="processFile()">Upload and Process</button>

    <div id="priceFilter" style="display:none; margin-top: 20px;">
        <label for="priceRange">Filter by Price: </label>
        <input type="range" id="priceRange" min="0" max="1000000" step="1000" value="1000000" oninput="updatePriceDisplay()">
        <span id="priceDisplay">1000000</span>
    </div>

    <div id="output" style="margin-top: 20px;"></div>

    <script>
        let addresses = [];

        function processFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                
                addresses = rows
                    .map(row => ({ address: row[8], price: parseFloat(row[4]) })) // Assuming column E is the 5th column (index 4)
                    .filter(row => row.address && !isNaN(row.price)); // Filter out rows with empty address or invalid price

                if (addresses.length > 0) {
                    // Show price filter
                    document.getElementById('priceFilter').style.display = 'block';

                    // Update max value of slider
                    const maxPrice = Math.max(...addresses.map(row => row.price));
                    document.getElementById('priceRange').max = maxPrice;
                    document.getElementById('priceRange').value = maxPrice;
                    updatePriceDisplay();

                    displayAddresses();
                } else {
                    alert('No valid addresses or prices found in the file.');
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function displayAddresses() {
            const output = document.getElementById('output');
            output.innerHTML = '';

            const maxPrice = parseFloat(document.getElementById('priceRange').value);

            addresses.filter(row => row.price <= maxPrice).forEach(row => {
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(row.address)}`;
                const linkElement = document.createElement('a');
                linkElement.href = mapLink;
                linkElement.target = '_blank';
                linkElement.textContent = `${row.address} - $${row.price}`;
                output.appendChild(linkElement);
                output.appendChild(document.createElement('br'));
            });
        }

        function updatePriceDisplay() {
            const price = document.getElementById('priceRange').value;
            document.getElementById('priceDisplay').textContent = price;
            displayAddresses();
        }
    </script>
</body>
</html>
